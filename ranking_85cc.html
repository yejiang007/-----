<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>CMX ä¸­å›½æ‘©æ‰˜è½¦è¶Šé‡é”¦æ ‡èµ› 2025 - 85ccé’å°‘å¹´ç»„æ’å</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            color: #e5e7eb;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        header {
            position: relative;
            background: linear-gradient(90deg, #0f172a, #1d4ed8);
            padding: 20px 24px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }

        .header-logo {
            position: absolute;
            left: 24px;
            top: 50%;
            transform: translateY(-50%);
            height: 60px;
            width: auto;
        }
        
        header h1 {
            font-size: 24px;
            font-weight: 700;
            margin: 0;
            background: linear-gradient(45deg, #f97316, #eab308);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .subtitle {
            font-size: 16px;
            color: #9ca3af;
            margin-top: 8px;
            font-weight: 500;
        }
        
        main {
            flex: 1;
            padding: 24px;
            max-width: 1200px;
            width: 100%;
            margin: 0 auto;
        }
        
        .ranking-container {
            background: rgba(2, 6, 23, 0.8);
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(59, 130, 246, 0.2);
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            background: transparent;
        }
        
        thead {
            background: linear-gradient(90deg, #1e40af, #3b82f6);
        }
        
        th {
            padding: 16px 20px;
            text-align: left;
            font-weight: 600;
            font-size: 16px;
            color: #f8fafc;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            border-bottom: 2px solid rgba(59, 130, 246, 0.3);
        }
        
        td {
            padding: 16px 20px;
            border-bottom: 1px solid rgba(17, 24, 39, 0.5);
            font-size: 22px;
            font-weight: 500;
        }
        
        tbody tr {
            transition: all 0.3s ease;
            background: rgba(15, 23, 42, 0.4);
        }
        
        tbody tr:nth-child(even) {
            background: rgba(15, 23, 42, 0.6);
        }
        
        tbody tr:hover {
            background: rgba(59, 130, 246, 0.1);
            transform: translateX(5px);
        }
        
        .rank-1 {
            background: linear-gradient(90deg, rgba(249, 115, 22, 0.2), rgba(249, 115, 22, 0.1)) !important;
            color: #f97316;
            font-weight: 700;
        }
        
        .rank-2 {
            background: linear-gradient(90deg, rgba(234, 179, 8, 0.2), rgba(234, 179, 8, 0.1)) !important;
            color: #eab308;
            font-weight: 600;
        }
        
        .rank-3 {
            background: linear-gradient(90deg, rgba(34, 197, 94, 0.2), rgba(34, 197, 94, 0.1)) !important;
            color: #22c55e;
            font-weight: 600;
        }
        
        .rank-number {
            font-size: 22px;
            font-weight: 800;
            text-align: center;
            width: 60px;
            font-style: italic;
            text-shadow: 0 0 10px rgba(249, 115, 22, 0.5);
        }
        
        /* æ’åå˜åŒ–ç®­å¤´ä¸åŠ¨ç”»ï¼ˆåŠ å¼ºç‰ˆï¼‰ */
        .delta { 
            margin-left: 10px; 
            font-size: 16px; 
            font-weight: 800; 
            line-height: 1; 
            padding: 2px 8px; 
            border-radius: 999px; 
            display: inline-block; 
        }
        .delta.up { 
            color: #22c55e; 
            background: rgba(34, 197, 94, 0.20); 
            border: 1px solid rgba(34, 197, 94, 0.55); 
            box-shadow: 0 0 12px rgba(34, 197, 94, 0.35);
        }
        .delta.down { 
            color: #ef4444; 
            background: rgba(239, 68, 68, 0.20); 
            border: 1px solid rgba(239, 68, 68, 0.55); 
            box-shadow: 0 0 12px rgba(239, 68, 68, 0.35);
        }
        .rank-up { 
            animation: rankUp 900ms ease-out; 
            will-change: transform, box-shadow, background; 
        }
        .rank-down { 
            animation: rankDown 900ms ease-out; 
            will-change: transform, box-shadow, background; 
        }
        .new-entry { animation: fadeInScale 700ms ease-out; }
        .rank-number-change { animation: pulseRank 700ms ease-out; }
        
        @keyframes rankUp {
            0% { transform: translateY(10px) scale(0.98); box-shadow: inset 0 0 0 2px rgba(34, 197, 94, 0.35); background: rgba(34, 197, 94, 0.12); }
            40% { transform: translateY(-4px) scale(1.02); }
            100% { transform: translateY(0) scale(1.0); box-shadow: inset 0 0 0 0 rgba(34, 197, 94, 0); background: transparent; }
        }
        
        @keyframes rankDown {
            0% { transform: translateY(-10px) scale(0.98); box-shadow: inset 0 0 0 2px rgba(239, 68, 68, 0.35); background: rgba(239, 68, 68, 0.12); }
            40% { transform: translateY(4px) scale(1.02); }
            100% { transform: translateY(0) scale(1.0); box-shadow: inset 0 0 0 0 rgba(239, 68, 68, 0); background: transparent; }
        }
        
        @keyframes fadeInScale {
            0% { opacity: 0; transform: scale(0.98); }
            100% { opacity: 1; transform: scale(1.0); }
        }
        
        @keyframes pulseRank {
            0% { transform: scale(1.0); text-shadow: 0 0 10px rgba(249, 115, 22, 0.5); }
            50% { transform: scale(1.12); text-shadow: 0 0 22px rgba(249, 115, 22, 0.8); }
            100% { transform: scale(1.0); text-shadow: 0 0 10px rgba(249, 115, 22, 0.5); }
        }
        .car-number {
            background: linear-gradient(135deg, #dc2626, #ef4444);
            color: white;
            padding: 6px 12px;
            border-radius: 20px;
            font-weight: 700;
            font-size: 14px;
            text-align: center;
            display: inline-block;
            min-width: 45px;
        }
        
        .flag {
            font-size: 22px;
            margin-right: 8px;
        }
        
        .player-name {
            font-weight: 600;
            color: #f8fafc;
            font-size: 22px;
        }
        
        .team-name {
            color: #9ca3af;
            font-size: 22px;
        }
        
        .loading {
            text-align: center;
            padding: 60px 20px;
            color: #9ca3af;
            font-size: 16px;
        }
        
        .error {
            text-align: center;
            padding: 60px 20px;
            color: #ef4444;
            font-size: 16px;
        }
        
        .status {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(2, 6, 23, 0.9);
            padding: 12px 16px;
            border-radius: 8px;
            border: 1px solid rgba(59, 130, 246, 0.2);
            font-size: 13px;
            color: #9ca3af;
            backdrop-filter: blur(10px);
        }
        
        .status-dot {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 8px;
            background: #22c55e;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .update-time {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: rgba(2, 6, 23, 0.9);
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 12px;
            color: #6b7280;
            border: 1px solid rgba(59, 130, 246, 0.1);
        }
        
        .pagination {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: rgba(2, 6, 23, 0.9);
            padding: 12px 16px;
            border-radius: 8px;
            border: 1px solid rgba(59, 130, 246, 0.2);
            font-size: 13px;
            color: #9ca3af;
            backdrop-filter: blur(10px);
        }
        
        .page-indicator {
            display: inline-block;
            margin: 0 8px;
            color: #f8fafc;
            font-weight: 600;
        }
        
        .auto-play-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #22c55e;
            margin-left: 8px;
            animation: pulse 2s infinite;
        }
        
        @media (max-width: 768px) {
            header h1 {
                font-size: 20px;
            }
            
            .subtitle {
                font-size: 14px;
            }
            
            main {
                padding: 16px;
            }
            
            th, td {
                padding: 12px 16px;
                font-size: 14px;
            }
            
            .rank-number {
                font-size: 16px;
                width: 50px;
                font-weight: 800;
                font-style: italic;
                text-shadow: 0 0 8px rgba(249, 115, 22, 0.4);
            }
            
            .car-number {
                padding: 4px 8px;
                font-size: 16px;
                min-width: 40px;
            }
            
            .flag {
                font-size: 18px;
            }
        }
        
        @media (max-width: 480px) {
            th:nth-child(4), td:nth-child(4) {
                display: none;
            }
        }
    </style>
</head>
<body>
    <header>
        <img src="https://mtc2025.ly7.cn/logo.png" alt="CMX Logo" class="header-logo">
        <h1>CMX ä¸­å›½æ‘©æ‰˜è½¦è¶Šé‡é”¦æ ‡èµ› 2025</h1>
        <div class="subtitle">85ccé’å°‘å¹´ç»„ - å®æ—¶æ’å</div>
    </header>
    
    <div class="status">
        <span class="status-dot"></span>
        <span id="connectionStatus">å®æ—¶æ›´æ–°ä¸­...</span>
    </div>
    
    <main>
        <div class="ranking-container">
            <table>
                <thead>
                    <tr>
                        <th style="width: 80px;">åæ¬¡</th>
                        <th style="width: 100px;">è½¦å·</th>
                        <th>é€‰æ‰‹</th>
                        <th style="width: 120px;">å›½ç±</th>
                        <th>è½¦é˜Ÿ</th>
                    </tr>
                </thead>
                <tbody id="rankingBody">
                    <tr>
                        <td colspan="5" class="loading">æ­£åœ¨åŠ è½½æ’åæ•°æ®...</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </main>
    
    <div class="update-time" id="updateTime"></div>
    
    <div class="pagination">
        <span>ç¬¬</span>
        <span class="page-indicator" id="currentPage">1</span>
        <span>é¡µ / å…±</span>
        <span class="page-indicator" id="totalPages">1</span>
        <span>é¡µ</span>
        <span class="auto-play-indicator" id="autoPlayIndicator"></span>
    </div>
    
    <script>
        const apiBase = '/api';
        const groupId = 1; // 85ccé’å°‘å¹´ç»„
        const itemsPerPage = 10; // æ¯é¡µæ˜¾ç¤º10ä¸ªæ•°æ®
        let previousRanking = {};
        let pollTimer = null;
        let autoPlayTimer = null;
        let currentPage = 1;
        let totalPages = 1;
        let allRankingData = [];
        let mockTick = 0; // æœ¬åœ°é¢„è§ˆæ—¶ç”¨äºæ¨¡æ‹Ÿæ’åå˜åŒ–
        
        function getFlag(nationality) {
            const map = {
                'ä¸­å›½': 'ğŸ‡¨ğŸ‡³', 'ä¸­å›½å¤§é™†': 'ğŸ‡¨ğŸ‡³', 'é¦™æ¸¯': 'ğŸ‡­ğŸ‡°', 'æ¾³é—¨': 'ğŸ‡²ğŸ‡´', 'å°æ¹¾': 'ğŸ‡¹ğŸ‡¼',
                'ç¾å›½': 'ğŸ‡ºğŸ‡¸', 'æ—¥æœ¬': 'ğŸ‡¯ğŸ‡µ', 'éŸ©å›½': 'ğŸ‡°ğŸ‡·', 'è‹±å›½': 'ğŸ‡¬ğŸ‡§', 'æ³•å›½': 'ğŸ‡«ğŸ‡·',
                'å¾·å›½': 'ğŸ‡©ğŸ‡ª', 'æ„å¤§åˆ©': 'ğŸ‡®ğŸ‡¹', 'è¥¿ç­ç‰™': 'ğŸ‡ªğŸ‡¸', 'æ¾³å¤§åˆ©äºš': 'ğŸ‡¦ğŸ‡º'
            };
            return map[nationality] || 'ğŸ';
        }
        
        function formatTime(dateStr) {
            const date = new Date(dateStr);
            return date.toLocaleTimeString('zh-CN', { 
                hour: '2-digit', 
                minute: '2-digit', 
                second: '2-digit' 
            });
        }
        
        function updateTime() {
            const now = new Date();
            document.getElementById('updateTime').textContent = 
                'æœ€åæ›´æ–°: ' + now.toLocaleTimeString('zh-CN');
        }
        
        function updatePagination() {
            document.getElementById('currentPage').textContent = currentPage;
            document.getElementById('totalPages').textContent = totalPages;
        }
        
        function getCurrentPageData() {
            const startIndex = (currentPage - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            return allRankingData.slice(startIndex, endIndex);
        }
        
        function nextPage() {
            if (currentPage < totalPages) {
                currentPage++;
            } else {
                currentPage = 1; // å¾ªç¯åˆ°ç¬¬ä¸€é¡µ
            }
            renderCurrentPage();
        }
        
        function startAutoPlay() {
            if (autoPlayTimer) {
                clearInterval(autoPlayTimer);
            }
            autoPlayTimer = setInterval(nextPage, 20000); // 20ç§’è‡ªåŠ¨ç¿»é¡µ
        }
        
        function stopAutoPlay() {
            if (autoPlayTimer) {
                clearInterval(autoPlayTimer);
                autoPlayTimer = null;
            }
        }
        
        function renderCurrentPage() {
            const pageData = getCurrentPageData();
            renderRanking(pageData);
            updatePagination();
        }
        
        function renderRanking(list) {
            const tbody = document.getElementById('rankingBody');
            
            if (!list || list.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" class="error">æš‚æ— æ’åæ•°æ®</td></tr>';
                return;
            }
            
            // æŒ‰æ’åæ’åº
            const sortedList = [...list].sort((a, b) => {
                return (parseInt(a.current_rank) || 0) - (parseInt(b.current_rank) || 0);
            });
            
            // è¡Œå”¯ä¸€é”®ï¼ˆä¼˜å…ˆ player_idï¼›æ— åˆ™ç”¨è½¦å·/å§“åä½œä¸ºé™çº§ï¼‰
            const keyOf = (row) => row.player_id ?? row.car_number ?? row.player_name ?? `${row.team_name}-${row.car_number}`;
            
            // æ£€æµ‹æ’åå˜åŒ–
            const currentRanking = {};
            sortedList.forEach(row => {
                const key = keyOf(row);
                currentRanking[key] = parseInt(row.current_rank) || 0;
            });
            
            tbody.innerHTML = '';
            
            sortedList.forEach(row => {
                const tr = document.createElement('tr');
                const rank = parseInt(row.current_rank) || 0;
                const key = keyOf(row);
                const previousRank = previousRanking[key];
                const delta = previousRank !== undefined ? (previousRank - rank) : 0; // æ­£æ•°è¡¨ç¤ºä¸Šå‡
                
                // æ·»åŠ æ’åæ ·å¼ï¼ˆå‰ä¸‰åé«˜äº®ï¼‰
                if (rank === 1) tr.classList.add('rank-1');
                else if (rank === 2) tr.classList.add('rank-2');
                else if (rank === 3) tr.classList.add('rank-3');
                
                const flag = getFlag(row.nationality || '');
                const deltaHtml = (previousRank !== undefined && previousRank !== rank)
                    ? `<span class=\"delta ${delta > 0 ? 'up' : 'down'}\">${delta > 0 ? 'â†‘' + delta : 'â†“' + Math.abs(delta)}</span>`
                    : '';
                
                tr.innerHTML = `
                    <td><div class=\"rank-number\">${rank}${deltaHtml}</div></td>
                    <td><span class=\"car-number\">${row.car_number || '-'}<\/span><\/td>
                    <td><span class=\"player-name\">${row.player_name || '-'}<\/span><\/td>
                    <td><span class=\"flag\">${flag}<\/span>${row.nationality || ''}<\/td>
                    <td><span class=\"team-name\">${row.team_name || '-'}<\/span><\/td>
                `;
                
                // æ’åå˜åŒ–åŠ¨ç”»
                const rankEl = tr.querySelector('.rank-number');
                if (previousRank === undefined) {
                    tr.classList.add('new-entry');
                } else if (previousRank !== rank) {
                    tr.classList.add(delta > 0 ? 'rank-up' : 'rank-down');
                    if (rankEl) rankEl.classList.add('rank-number-change');
                }
                
                tbody.appendChild(tr);
            });
            
            // æ›´æ–°ä¸Šä¸€æ¬¡æ’åæ•°æ®ï¼ˆä½¿ç”¨åŒæ ·çš„ keyï¼‰
            previousRanking = currentRanking;
            updateTime();
        }
        
        function processAndDisplayRanking(data) {
            if (data && data.length > 0) {
                allRankingData = [...data].sort((a, b) => {
                    return (parseInt(a.current_rank) || 0) - (parseInt(b.current_rank) || 0);
                });
                
                // è®¡ç®—æ€»é¡µæ•°
                totalPages = Math.ceil(allRankingData.length / itemsPerPage);
                if (totalPages === 0) totalPages = 1;
                
                // ä¿ç•™å½“å‰é¡µï¼›è‹¥å½“å‰é¡µè¶…å‡ºèŒƒå›´ï¼Œå¤¹ç´§åˆ°æœ€åä¸€é¡µ
                if (currentPage > totalPages) currentPage = totalPages;
                if (currentPage < 1) currentPage = 1;
                
                // æ˜¾ç¤ºå½“å‰é¡µ
                renderCurrentPage();
                
                // ä¸é‡å¯è‡ªåŠ¨æ’­æ”¾ï¼Œä¿æŒåŸæœ‰èŠ‚å¥
                // startAutoPlay();
            } else {
                renderRanking([]);
            }
        }
        
        async function fetchRanking() {
            try {
                const timestamp = new Date().getTime();
                const res = await fetch(`${apiBase}/ranking.php?action=getGroupRanking&group_id=${groupId}&_t=${timestamp}`, {
                    cache: 'no-cache',
                    headers: {
                        'Cache-Control': 'no-cache'
                    }
                });
                
                if (!res.ok) {
                    throw new Error('ç½‘ç»œè¯·æ±‚å¤±è´¥');
                }
                
                const json = await res.json();
                
                if (json.code === 200 && json.data && json.data.ranking_list) {
                    processAndDisplayRanking(json.data.ranking_list);
                    document.getElementById('connectionStatus').textContent = 'å®æ—¶æ›´æ–°ä¸­...';
                } else {
                    throw new Error(json.msg || 'è·å–æ•°æ®å¤±è´¥');
                }
            } catch (error) {
                console.error('è·å–æ’åå¤±è´¥:', error);
                document.getElementById('connectionStatus').textContent = 'è¿æ¥å¤±è´¥ï¼Œé‡è¯•ä¸­...';
                
                // ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ® - æ‰©å±•åˆ°15æ¡æ•°æ®ä»¥æµ‹è¯•åˆ†é¡µï¼Œå¹¶æ¯æ¬¡è½®è¯¢æ¨¡æ‹Ÿå°å¹…æ’åå˜åŒ–
                const baseMock = [
                    { player_id: 101, current_rank: 1, car_number: '88', player_name: 'å¼ ä¸‰', nationality: 'ä¸­å›½', team_name: 'CMXé’å°‘å¹´è½¦é˜Ÿ' },
                    { player_id: 102, current_rank: 2, car_number: '21', player_name: 'æå¼º', nationality: 'ä¸­å›½', team_name: 'å²­å—å°‘å¹´è¶Šé‡é˜Ÿ' },
                    { player_id: 103, current_rank: 3, car_number: '66', player_name: 'Wang Hua', nationality: 'ä¸­å›½', team_name: 'é£é©°è¶Šé‡è½¦é˜Ÿ' },
                    { player_id: 104, current_rank: 4, car_number: '15', player_name: 'Chen Yu', nationality: 'ä¸­å›½', team_name: 'æ˜Ÿç«é’è®­è½¦é˜Ÿ' },
                    { player_id: 105, current_rank: 5, car_number: '37', player_name: 'Liu Kai', nationality: 'ä¸­å›½', team_name: 'å±±åœ°å°‘å¹´è½¦é˜Ÿ' },
                    { player_id: 106, current_rank: 6, car_number: '99', player_name: 'Li Ming', nationality: 'ä¸­å›½', team_name: 'æé€Ÿè¶Šé‡è½¦é˜Ÿ' },
                    { player_id: 107, current_rank: 7, car_number: '52', player_name: 'Zhao Rui', nationality: 'ä¸­å›½', team_name: 'ååŒ—å°‘å¹´è¶Šé‡é˜Ÿ' },
                    { player_id: 108, current_rank: 8, car_number: '73', player_name: 'Sun Hao', nationality: 'ä¸­å›½', team_name: 'CMXé’å°‘å¹´è½¦é˜Ÿ' },
                    { player_id: 109, current_rank: 9, car_number: '11', player_name: 'Zhou Jie', nationality: 'ä¸­å›½', team_name: 'åå—å°‘å¹´è½¦é˜Ÿ' },
                    { player_id: 110, current_rank: 10, car_number: '28', player_name: 'Wu Lei', nationality: 'ä¸­å›½', team_name: 'åä¸œè¶Šé‡ä¿±ä¹éƒ¨' },
                    { player_id: 111, current_rank: 11, car_number: '45', player_name: 'Zheng Tao', nationality: 'ä¸­å›½', team_name: 'è¥¿å—é’è®­è½¦é˜Ÿ' },
                    { player_id: 112, current_rank: 12, car_number: '67', player_name: 'He Feng', nationality: 'ä¸­å›½', team_name: 'ä¸œåŒ—å°‘å¹´è½¦é˜Ÿ' },
                    { player_id: 113, current_rank: 13, car_number: '82', player_name: 'Gao Yuan', nationality: 'ä¸­å›½', team_name: 'è¥¿åŒ—é£é©°è½¦é˜Ÿ' },
                    { player_id: 114, current_rank: 14, car_number: '34', player_name: 'Dong Wei', nationality: 'ä¸­å›½', team_name: 'ä¸­åŸè¶Šé‡é˜Ÿ' },
                    { player_id: 115, current_rank: 15, car_number: '59', player_name: 'Xiang Yang', nationality: 'ä¸­å›½', team_name: 'é•¿æ±Ÿé’è®­è½¦é˜Ÿ' }
                ];
                
                // æ¨¡æ‹Ÿéƒ¨åˆ†æ’åäº¤æ›¿å˜åŒ–ï¼ˆä»…ä¾›æœ¬åœ°é¢„è§ˆè§‚å¯ŸåŠ¨ç”»æ•ˆæœï¼‰
                mockTick++;
                const mockData = baseMock.map(x => ({ ...x }));
                if (mockTick % 2 === 1) {
                    mockData[1].current_rank = 3; // 102 ä»2é™åˆ°3
                    mockData[2].current_rank = 2; // 103 ä»3å‡åˆ°2
                    mockData[5].current_rank = 5; // 106 6->5 ä¸Šå‡
                    mockData[4].current_rank = 6; // 105 5->6 ä¸‹é™
                } // else æ¢å¤åŸå§‹é¡ºåº
                
                processAndDisplayRanking(mockData);
            }
        }
        
        // åˆå§‹åŒ–
        async function init() {
            updateTime();
            await fetchRanking();
            
            // æ¯3ç§’æ›´æ–°ä¸€æ¬¡æ•°æ®ï¼ˆå®æ—¶åˆ·æ–°ï¼‰
            pollTimer = setInterval(fetchRanking, 3000);
        }
        
        // é¡µé¢å¯è§æ€§æ£€æµ‹
        document.addEventListener('visibilitychange', () => {
            if (!document.hidden) {
                fetchRanking();
            }
        });
        
        // çª—å£è·å¾—ç„¦ç‚¹æ—¶åˆ·æ–°æ•°æ®
        window.addEventListener('focus', () => {
            fetchRanking();
        });
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', init);
        
        // é¡µé¢å¸è½½æ—¶æ¸…ç†å®šæ—¶å™¨
        window.addEventListener('beforeunload', () => {
            if (pollTimer) {
                clearInterval(pollTimer);
            }
            if (autoPlayTimer) {
                clearInterval(autoPlayTimer);
            }
        });
        
        // é¡µé¢å¯è§æ€§å˜åŒ–æ—¶æ§åˆ¶è‡ªåŠ¨æ’­æ”¾
        document.addEventListener('visibilitychange', () => {
            if (document.hidden) {
                stopAutoPlay();
            } else {
                startAutoPlay();
            }
        });
    </script>
</body>
</html>